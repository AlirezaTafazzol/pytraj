<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tips &mdash; pytraj 0.1.2.dev12+d871e3b documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/searchbox.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.3.4/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1.2.dev12+d871e3b',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/lunr.js/0.6.0/lunr.min.js"></script>
    <script type="text/javascript" src="_static/js/searchbox.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="pytraj 0.1.2.dev12+d871e3b documentation" href="index.html" />
    <link rel="up" title="Cookbook" href="cookbook.html" />
    <link rel="next" title="Tips for out-of-core loading" href="tips_iterload.html" />
    <link rel="prev" title="Cookbook" href="cookbook.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          pytraj</a>
        <span class="navbar-text navbar-version pull-left"><b>0.1.2.dev12+d871e3b</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="trajectory.html">Trajectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="topology.html">Topology</a></li>
<li class="toctree-l1"><a class="reference internal" href="read_and_write.html">Read and Write</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="modify_traj.html">Modify trajectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="atom_mask_selection.html">Atom mask selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="trajectory_slice.html">Fancy indexing of trajectory</a></li>
<li class="toctree-l1"><a class="reference internal" href="parallel.html">Parallel calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="whatsnew.html">What&#8217;s new?</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer guide for pytraj</a></li>
<li class="toctree-l1"><a class="reference internal" href="misc.html">Misc</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API reference</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Tips</a><ul>
<li><a class="reference internal" href="#process-many-files">process many files</a></li>
<li><a class="reference internal" href="#load-from-a-list-of-files-with-frame-stride">load from a list of files with frame stride</a></li>
<li><a class="reference internal" href="#load-specific-frame-numbers-to-memory">load specific frame numbers to memory</a></li>
<li><a class="reference internal" href="#merge-multiple-trajectories-to-a-single-file">merge multiple trajectories to a single file</a></li>
<li><a class="reference internal" href="#memory-saving">memory saving</a></li>
<li><a class="reference internal" href="#convert-trajectory">convert trajectory</a></li>
<li><a class="reference internal" href="#pickle-data">pickle data</a></li>
<li><a class="reference internal" href="#speed-up-calculation-with-parallel-mpi4py">speed up calculation with parallel (mpi4py)</a></li>
<li><a class="reference internal" href="#read-cpptraj-manual">read cpptraj manual</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="cookbook.html" title="Previous Chapter: Cookbook"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Cookbook</span>
    </a>
  </li>
  <li>
    <a href="tips_iterload.html" title="Next Chapter: Tips for out-of-core loading"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Tips for out-... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/tips.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="tips">
<span id="id1"></span><h1><a class="toc-backref" href="#id3">Tips</a><a class="headerlink" href="#tips" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#tips" id="id3">Tips</a><ul>
<li><a class="reference internal" href="#process-many-files" id="id4">process many files</a></li>
<li><a class="reference internal" href="#load-from-a-list-of-files-with-frame-stride" id="id5">load from a list of files with frame stride</a></li>
<li><a class="reference internal" href="#load-specific-frame-numbers-to-memory" id="id6">load specific frame numbers to memory</a></li>
<li><a class="reference internal" href="#merge-multiple-trajectories-to-a-single-file" id="id7">merge multiple trajectories to a single file</a></li>
<li><a class="reference internal" href="#memory-saving" id="id8">memory saving</a></li>
<li><a class="reference internal" href="#convert-trajectory" id="id9">convert trajectory</a></li>
<li><a class="reference internal" href="#pickle-data" id="id10">pickle data</a></li>
<li><a class="reference internal" href="#speed-up-calculation-with-parallel-mpi4py" id="id11">speed up calculation with parallel (mpi4py)</a></li>
<li><a class="reference internal" href="#read-cpptraj-manual" id="id12">read cpptraj manual</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="process-many-files">
<span id="id2"></span><h2><a class="toc-backref" href="#id4">process many files</a><a class="headerlink" href="#process-many-files" title="Permalink to this headline">¶</a></h2>
<p>Normally, user needs to follow below code to process many files</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">pytraj</span> <span class="kn">as</span> <span class="nn">pt</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="gp">In [3]: </span><span class="n">template</span> <span class="o">=</span> <span class="s">&#39;tz2.</span><span class="si">%s</span><span class="s">.nc&#39;</span>

<span class="gp">In [4]: </span><span class="n">flist</span> <span class="o">=</span> <span class="p">[</span><span class="n">template</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="gp">In [5]: </span><span class="k">print</span><span class="p">(</span><span class="n">flist</span><span class="p">)</span>
<span class="go">[&#39;tz2.0.nc&#39;, &#39;tz2.1.nc&#39;, &#39;tz2.2.nc&#39;, &#39;tz2.3.nc&#39;]</span>

<span class="gp">In [6]: </span><span class="n">trajlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;tz2.parm7&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">flist</span><span class="p">]</span>

<span class="c"># calculate radgyr</span>
<span class="gp">In [7]: </span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="gp">In [8]: </span><span class="k">for</span> <span class="n">traj</span> <span class="ow">in</span> <span class="n">trajlist</span><span class="p">:</span>
<span class="gp">   ...:</span>     <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt</span><span class="o">.</span><span class="n">radgyr</span><span class="p">(</span><span class="n">traj</span><span class="p">))</span>
<span class="gp">   ...:</span> 

<span class="gp">In [9]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="gp">In [10]: </span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">[  9.4451   9.5746  10.1923 ...,   7.4834   7.4324   7.6204]</span>
</pre></div>
</div>
<p>However, <code class="docutils literal"><span class="pre">pytraj</span></code> offer shorter (and easy?) way to do</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="c"># load all files into a single TrajectoryIterator</span>
<span class="gp">In [11]: </span><span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;tz2.0.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.1.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.2.nc&#39;</span><span class="p">]</span>

<span class="gp">In [12]: </span><span class="n">traj</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">(</span><span class="n">filelist</span><span class="p">,</span> <span class="s">&#39;tz2.parm7&#39;</span><span class="p">)</span>

<span class="c"># perform calculation</span>
<span class="gp">In [13]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">radgyr</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>

<span class="c"># that&#39;s it</span>
<span class="gp">In [14]: </span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">[  9.4451   9.5746  10.1923 ...,   7.4834   7.4324   7.6204]</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">pytraj</span></code> will auto-allocate <code class="docutils literal"><span class="pre">data</span></code> too</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="k">print</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trajlist</span><span class="p">])</span>
<span class="go">[&#39;tz2.0.nc&#39;, &#39;tz2.1.nc&#39;, &#39;tz2.2.nc&#39;, &#39;tz2.3.nc&#39;]</span>

<span class="gp">In [16]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">radgyr</span><span class="p">(</span><span class="n">trajlist</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="n">trajlist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>

<span class="gp">In [17]: </span><span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go">[  9.4451   9.5746  10.1923 ...,   7.4834   7.4324   7.6204]</span>
</pre></div>
</div>
</div>
<div class="section" id="load-from-a-list-of-files-with-frame-stride">
<h2><a class="toc-backref" href="#id5">load from a list of files with frame stride</a><a class="headerlink" href="#load-from-a-list-of-files-with-frame-stride" title="Permalink to this headline">¶</a></h2>
<p>Supposed you have a list of 5 (or whatever) trajectories, you only want to load those files 1st to 100-th frames
and skip every 10 frames. Below is a convention <code class="docutils literal"><span class="pre">cpptraj</span></code> input.</p>
<div class="highlight-bash"><div class="highlight"><pre>parm 2koc.parm7
trajin traj0.nc <span class="m">1</span> <span class="m">100</span> 10
trajin traj1.nc <span class="m">1</span> <span class="m">100</span> 10
trajin traj2.nc <span class="m">1</span> <span class="m">100</span> 10
trajin traj3.nc <span class="m">1</span> <span class="m">100</span> 10
trajin traj4.nc <span class="m">1</span> <span class="m">100</span> 10
</pre></div>
</div>
<p>In <code class="docutils literal"><span class="pre">pytraj</span></code>, you can specify <code class="docutils literal"><span class="pre">frame_slice</span></code></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">pytraj</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">(</span><span class="s">&#39;traj*.nc&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s">&#39;2koc.parm7&#39;</span><span class="p">,</span> <span class="n">frame_slice</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">),]</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># [(0, 100, 10),]*5 is equal to [(0, 100, 10), (0, 100, 10),(0, 100, 10),(0, 100, 10),(0, 100, 10),]</span>
</pre></div>
</div>
</div>
<div class="section" id="load-specific-frame-numbers-to-memory">
<h2><a class="toc-backref" href="#id6">load specific frame numbers to memory</a><a class="headerlink" href="#load-specific-frame-numbers-to-memory" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [18]: </span><span class="kn">import</span> <span class="nn">pytraj</span> <span class="kn">as</span> <span class="nn">pt</span>

<span class="gp">In [19]: </span><span class="n">frame_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>

<span class="c"># use ``load`` to load those frames to memory</span>
<span class="gp">In [20]: </span><span class="n">traj0</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;tz2.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.parm7&#39;</span><span class="p">,</span> <span class="n">frame_indices</span><span class="o">=</span><span class="n">frame_indices</span><span class="p">)</span>

<span class="gp">In [21]: </span><span class="n">traj0</span>
<span class="gr">Out[21]: </span>
<span class="go">pytraj.Trajectory, 5 frames: </span>
<span class="go">Size: 0.000025 (GB)</span>
<span class="go">&lt;Topology: 223 atoms, 13 residues, 1 mols, non-PBC&gt;</span>
<span class="go">           </span>

<span class="c"># only loadd coordinates for specific atoms</span>
<span class="gp">In [22]: </span><span class="n">traj1</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;tz2.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.parm7&#39;</span><span class="p">,</span> <span class="n">frame_indices</span><span class="o">=</span><span class="n">frame_indices</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="s">&#39;@CA&#39;</span><span class="p">)</span>

<span class="gp">In [23]: </span><span class="n">traj1</span>
<span class="gr">Out[23]: </span>
<span class="go">pytraj.Trajectory, 5 frames: </span>
<span class="go">Size: 0.000001 (GB)</span>
<span class="go">&lt;Topology: 12 atoms, 12 residues, 12 mols, non-PBC&gt;</span>
<span class="go">           </span>

<span class="c"># or use ``iterload``</span>
<span class="gp">In [24]: </span><span class="n">frame_indices</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>

<span class="gp">In [25]: </span><span class="n">traj2</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">(</span><span class="s">&#39;tz2.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.parm7&#39;</span><span class="p">)</span>

<span class="gp">In [26]: </span><span class="n">traj2</span>
<span class="gr">Out[26]: </span>
<span class="go">pytraj.TrajectoryIterator, 101 frames: </span>
<span class="go">Size: 0.000503 (GB)</span>
<span class="go">&lt;Topology: 223 atoms, 13 residues, 1 mols, non-PBC&gt;</span>
<span class="go">           </span>

<span class="gp">In [27]: </span><span class="n">traj2</span><span class="p">[</span><span class="n">frame_indices</span><span class="p">,</span> <span class="s">&#39;@CA&#39;</span><span class="p">]</span>
<span class="go">                                                                                                                                      Out[27]: </span>
<span class="go">pytraj.Trajectory, 5 frames: </span>
<span class="go">Size: 0.000001 (GB)</span>
<span class="go">&lt;Topology: 12 atoms, 12 residues, 12 mols, non-PBC&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="merge-multiple-trajectories-to-a-single-file">
<h2><a class="toc-backref" href="#id7">merge multiple trajectories to a single file</a><a class="headerlink" href="#merge-multiple-trajectories-to-a-single-file" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [28]: </span><span class="kn">import</span> <span class="nn">pytraj</span> <span class="kn">as</span> <span class="nn">pt</span>

<span class="c"># load multiple files</span>
<span class="gp">In [29]: </span><span class="n">traj</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">([</span><span class="s">&#39;tz2.0.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.1.nc&#39;</span><span class="p">,</span> <span class="s">&#39;tz2.2.nc&#39;</span><span class="p">],</span> <span class="n">top</span><span class="o">=</span><span class="s">&#39;tz2.parm7&#39;</span><span class="p">)</span>

<span class="gp">In [30]: </span><span class="n">traj</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;tz2_combined.nc&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="memory-saving">
<h2><a class="toc-backref" href="#id8">memory saving</a><a class="headerlink" href="#memory-saving" title="Permalink to this headline">¶</a></h2>
<p>If memory is critical, do not load all frames into memory.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="c"># DO this (only a single frame will be loaded to memory)</span>
<span class="gp">In [31]: </span><span class="n">pt</span><span class="o">.</span><span class="n">radgyr</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">frame_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">301</span><span class="p">])</span>
<span class="gr">Out[31]: </span><span class="n">array</span><span class="p">([</span> <span class="mf">9.4451</span><span class="p">,</span>  <span class="mf">7.4324</span><span class="p">,</span>  <span class="mf">7.4834</span><span class="p">,</span>  <span class="mf">7.4324</span><span class="p">])</span>

<span class="c"># DON&#39;T do this if you want to save memory (all 4 frames will be loaded to memory)</span>
<span class="gp">In [32]: </span><span class="n">pt</span><span class="o">.</span><span class="n">radgyr</span><span class="p">(</span><span class="n">traj</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">301</span><span class="p">]])</span>
<span class="go">                                                     Out[32]: array([ 9.4451,  7.4324,  7.4834,  7.4324])</span>

<span class="gp">In [33]: </span><span class="n">pt</span><span class="o">.</span><span class="n">iterframe</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="n">frame_indices</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">301</span><span class="p">])</span>
<span class="go">                                                                                                          Out[33]: </span>
<span class="go">&lt;FrameIterator with start=None, stop=None, step=None, n_frames=4, </span>
<span class="go">frame_indices=[0, 200, 300, 301], </span>
<span class="go">mask=None, autoimage=False, rmsfit=None, copy=False&gt; </span>

<span class="gp">In [34]: </span><span class="n">traj</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">301</span><span class="p">]]</span>
<span class="go">                                                                                                                                                                                                                                                                                Out[34]: </span>
<span class="go">pytraj.Trajectory, 4 frames: </span>
<span class="go">Size: 0.000020 (GB)</span>
<span class="go">&lt;Topology: 223 atoms, 13 residues, 1 mols, non-PBC&gt;</span>
</pre></div>
</div>
<p>Example: calculate pairwise rmsd for 3000 frames (~3.9 G) only costs 112.7 MB</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>python memory/pairwise_rmsd_shorter_version.py

pytraj.TrajectoryIterator, <span class="m">3000</span> frames:
Size: 3.911264 <span class="o">(</span>GB<span class="o">)</span>
&lt;Topology: <span class="m">58329</span> atoms, <span class="m">19202</span> residues, <span class="m">19168</span> mols, PBC with box <span class="nb">type</span> <span class="o">=</span> ortho&gt;

Filename: memory/pairwise_rmsd_shorter_version.py

Line <span class="c">#    Mem usage    Increment   Line Contents</span>
<span class="o">================================================</span>
     <span class="m">6</span>     30.1 MiB      0.0 MiB   @profile
     <span class="m">7</span>                             def compute<span class="o">(</span><span class="nv">mask</span><span class="o">=</span><span class="s1">&#39;!:WAT,K+,Cl-&#39;</span>, <span class="nv">mat_type</span><span class="o">=</span><span class="s1">&#39;half&#39;</span><span class="o">)</span>:
     <span class="m">8</span>     64.0 MiB     33.9 MiB       <span class="nv">traj</span> <span class="o">=</span> pt.iterload<span class="o">(</span><span class="s1">&#39;GAAC3.5000frames.nc&#39;</span>, <span class="s1">&#39;GAAC.topo&#39;</span>, <span class="nv">frame_slice</span><span class="o">=(</span>0, 3000<span class="o">))</span>
     <span class="m">9</span>     64.1 MiB      0.1 MiB       print<span class="o">(</span>traj<span class="o">)</span>
    <span class="m">10</span>    112.7 MiB     48.5 MiB       <span class="k">return</span> pt.pairwise_rmsd<span class="o">(</span>traj, <span class="nv">mask</span><span class="o">=</span>mask, <span class="nv">mat_type</span><span class="o">=</span>mat_type<span class="o">)</span>
</pre></div>
</div>
<p>See also: <a class="reference internal" href="trajectory_slice.html#trajectory-slice"><span>Fancy indexing of trajectory</span></a></p>
</div>
<div class="section" id="convert-trajectory">
<h2><a class="toc-backref" href="#id9">convert trajectory</a><a class="headerlink" href="#convert-trajectory" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># convert Amber netcdf to Charmm dcd file.</span>
<span class="n">pt</span><span class="o">.</span><span class="n">iterload</span><span class="p">(</span><span class="s">&#39;traj.nc&#39;</span><span class="p">,</span> <span class="s">&#39;prmtop&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s">&#39;traj.dcd&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="pickle-data">
<h2><a class="toc-backref" href="#id10">pickle data</a><a class="headerlink" href="#pickle-data" title="Permalink to this headline">¶</a></h2>
<p>Sometimes you need to perform very long analysis (hours), you need to save the output to
disk to do further analysis. You have options to save data to different files and write
code to load the data back. However, you can use <code class="docutils literal"><span class="pre">pytraj.to_pickle</span></code> nad
<code class="docutils literal"><span class="pre">pytraj.read_pickle</span></code> to save the state of data. Check the example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [35]: </span><span class="n">traj3</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">load_pdb_rcsb</span><span class="p">(</span><span class="s">&#39;1l2y&#39;</span><span class="p">)</span>

<span class="gp">In [36]: </span><span class="n">data</span> <span class="o">=</span> <span class="n">pt</span><span class="o">.</span><span class="n">dssp</span><span class="p">(</span><span class="n">traj</span><span class="p">,</span> <span class="s">&#39;:3-7&#39;</span><span class="p">)</span>

<span class="gp">In [37]: </span><span class="n">data</span>
<span class="gr">Out[37]: </span>
<span class="go">(array([&#39;THR:3&#39;, &#39;TRP:4&#39;, &#39;GLU:5&#39;, &#39;ASN:6&#39;, &#39;GLY:7&#39;], </span>
<span class="go">       dtype=&#39;&lt;U5&#39;), array([[&#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        ..., </span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;]], </span>
<span class="go">       dtype=&#39;&lt;U1&#39;), &lt;pytraj.DatasetList with 8 datasets&gt;</span>
<span class="go">none_avg</span>
<span class="go">[ 1.   0.8  0.8 ...,  1.   0.8  0.8]</span>

<span class="go">para_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>

<span class="go">anti_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>
<span class="go">...</span>

<span class="go">turn_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>

<span class="go">bend_avg</span>
<span class="go">[ 0.   0.2  0.2 ...,  0.   0.2  0.2])</span>

<span class="gp">In [38]: </span><span class="n">pt</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&#39;my_data.pk&#39;</span><span class="p">)</span>

<span class="c"># load the data&#39;s state back for further analysis</span>
<span class="gp">In [39]: </span><span class="n">pt</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s">&#39;my_data.pk&#39;</span><span class="p">)</span>
<span class="gr">Out[39]: </span>
<span class="go">(array([&#39;THR:3&#39;, &#39;TRP:4&#39;, &#39;GLU:5&#39;, &#39;ASN:6&#39;, &#39;GLY:7&#39;], </span>
<span class="go">       dtype=&#39;&lt;U5&#39;), array([[&#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        ..., </span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;],</span>
<span class="go">        [&#39;0&#39;, &#39;0&#39;, &#39;S&#39;, &#39;0&#39;, &#39;0&#39;]], </span>
<span class="go">       dtype=&#39;&lt;U1&#39;), &lt;pytraj.DatasetList with 8 datasets&gt;</span>
<span class="go">none_avg</span>
<span class="go">[ 1.   0.8  0.8 ...,  1.   0.8  0.8]</span>

<span class="go">para_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>

<span class="go">anti_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>
<span class="go">...</span>

<span class="go">turn_avg</span>
<span class="go">[ 0.  0.  0. ...,  0.  0.  0.]</span>

<span class="go">bend_avg</span>
<span class="go">[ 0.   0.2  0.2 ...,  0.   0.2  0.2])</span>

</pre></div>
</div>
</div>
<div class="section" id="speed-up-calculation-with-parallel-mpi4py">
<h2><a class="toc-backref" href="#id11">speed up calculation with parallel (mpi4py)</a><a class="headerlink" href="#speed-up-calculation-with-parallel-mpi4py" title="Permalink to this headline">¶</a></h2>
<p>Just experimental code, try it with your own risk</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>cat radgyr_mpi.py
import pytraj as pt

<span class="c"># add extra lines</span>
from pytraj.parallel import map_mpi
from mpi4py import MPI
<span class="nv">comm</span> <span class="o">=</span> MPI.COMM_WORLD

<span class="nv">traj</span> <span class="o">=</span> pt.iterload<span class="o">(</span><span class="s1">&#39;md.nc&#39;</span>, <span class="s1">&#39;tc5bwat.top&#39;</span><span class="o">)</span>
<span class="nv">data</span> <span class="o">=</span> map_mpi<span class="o">(</span>pt.radgyr, traj, <span class="s1">&#39;@CA&#39;</span><span class="o">)</span>

<span class="k">if</span> comm.rank <span class="o">==</span> 0:
    pt.to_pickle<span class="o">(</span>data, <span class="s1">&#39;data.pk&#39;</span><span class="o">)</span>

<span class="nv">$ </span><span class="c"># run</span>
<span class="nv">$ </span>mpirun -n <span class="m">4</span> python radgyr_mpi.py
</pre></div>
</div>
</div>
<div class="section" id="read-cpptraj-manual">
<h2><a class="toc-backref" href="#id12">read cpptraj manual</a><a class="headerlink" href="#read-cpptraj-manual" title="Permalink to this headline">¶</a></h2>
<p>This does not work with ipython-notebook but it&#8217;s still good for interactive ipython</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">106</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pytraj</span> <span class="kn">as</span> <span class="nn">pt</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">107</span><span class="p">]:</span> <span class="n">pt</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;radgyr&#39;</span><span class="p">)</span>
        <span class="p">[</span><span class="o">&lt;</span><span class="n">name</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">mask1</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">out</span> <span class="o">&lt;</span><span class="n">filename</span><span class="o">&gt;</span><span class="p">]</span> <span class="p">[</span><span class="n">mass</span><span class="p">]</span> <span class="p">[</span><span class="n">nomax</span><span class="p">]</span> <span class="p">[</span><span class="n">tensor</span><span class="p">]</span>
          <span class="n">Calculate</span> <span class="n">radius</span> <span class="n">of</span> <span class="n">gyration</span> <span class="n">of</span> <span class="n">atoms</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">mask</span><span class="o">&gt;</span>
</pre></div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2015, pytraj developers.<br/>
      Last updated on Nov 25, 2015.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>